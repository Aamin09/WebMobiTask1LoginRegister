@model Task1LoginRegister.Models.ProductVariant

@{
    // First checking if variant has images
    var hasVariantImages = Model.ProductImages != null && Model.ProductImages.Any();
    var primaryMedia = hasVariantImages ?
        Model.ProductImages.FirstOrDefault(img => img.IsPrimaryImage) :
        null;

    // If no variant images, get the parent product's images
    if (!hasVariantImages && Model.Product?.ProductImages != null)
    {
        primaryMedia = Model.Product.ProductImages.FirstOrDefault(img => img.IsPrimaryImage);
    }
}

@if (primaryMedia != null)
{
    var fileExtension = System.IO.Path.GetExtension(primaryMedia.ImageUrl)?.ToLower();

    if (fileExtension == ".jpg" || fileExtension == ".jpeg" || fileExtension == ".png" || fileExtension == ".gif" || fileExtension == ".webp")
    {
        <img src="@primaryMedia.ImageUrl" class="product-image img-fluid card-img-top rounded-3"
             alt="@(hasVariantImages ? "Variant Image" : "Product Image")">
    }
    else if (fileExtension == ".mp4" || fileExtension == ".webm" || fileExtension == ".ogg")
    {
        <video class="product-video img-fluid product-image card-img-top rounded-3" controls autoplay loop>
            <source src="@primaryMedia.ImageUrl" type="video/@fileExtension.Substring(1)">
            Your browser does not support the video tag.
        </video>
    }
}